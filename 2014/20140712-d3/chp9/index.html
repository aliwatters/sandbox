<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>D3 Page Template</title>
        <script src='../d3/d3.js'></script>
        <style>
            div.container {
                width:100%;
                height:450px;
            }
            div.item {
                border:1px solid #ddd;
                margin:20px;
                padding:10px;
                text-align:center;
                height:100%;
            }
        </style>
    </head>
    <body>
        <div class='container'>
            <button id="update-ex1">Update Data</button>
            <div id='ex1' class='item'></div>
        </div>
        <script>
            var dataset = [];
            var i;
            var v;
            var max = 100;

            for (i = 0; i < 25; i++) {
                v = Math.round(Math.random() * max);
                dataset.push(v);
            }
//            [5, 14, 13, 30, 41, 36, 12, 23, 13, 11, 7, 4, 1];

        
            var w = parseInt(d3.select("#ex1").style("width").slice(0,-2), 10);
            var h = parseInt(d3.select("#ex1").style("height").slice(0,-2), 10);

            var barPadding = 1;


            var xScale = d3.scale.ordinal()
                .domain(d3.range(dataset.length))
                .rangeRoundBands([0, w], 0.05);

			var yScale = d3.scale.linear()
							.domain([0, d3.max(dataset)])
							.range([0, h]);
			
			//Create SVG element
			var svg = d3.select("#ex1")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			//Create bars
			svg.selectAll("rect")
			   .data(dataset)
			   .enter()
			   .append("rect")
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return h - yScale(d);
			   })
			   .attr("width", xScale.rangeBand())
			   .attr("height", function(d) {
			   		return yScale(d);
			   })
			   .attr("fill", function(d) {
					return "rgb(0, 0, " + (d * 10) + ")";
			   });

			//Create labels
			svg.selectAll("text")
			   .data(dataset)
			   .enter()
			   .append("text")
			   .text(function(d) {
			   		return d;
			   })
			   .attr("text-anchor", "middle")
			   .attr("x", function(d, i) {
			   		return xScale(i) + xScale.rangeBand() / 2;
			   })
			   .attr("y", function(d) {
			   		return h - yScale(d) + 14;
			   })
			   .attr("font-family", "sans-serif")
			   .attr("font-size", "11px")
			   .attr("fill", "white");


            d3.select('#update-ex1')
                .on("click", function() {
                    
                   for (i = 0; i < dataset.length; i++) {
                        v = Math.round(Math.random() * max);
                        dataset[i] = v;
                    }

                    yScale.domain([0, d3.max(dataset)]); // update scale to reflect new max

                    svg.selectAll("rect")
                        .data(dataset)
                        .transition()
                        .delay(function (d, i) {return i / dataset.length * 1000; })
                        .duration(2000)
                        .ease("elastic")
                        .attr("y", function(d) {
        			        return h -  yScale(d);
	            	    })
        			    .attr("height", function(d) {
        	   		        return yScale(d);
                        })
                        .attr("fill", function(d) {
        					return "rgb(0, 0, " + (d * 10) + ")";
		        	    });

                    svg.selectAll("text")
			            .data(dataset)
                        .transition()
                        .delay(function (d, i) {return i / dataset.length * 1000; })
                        .duration(2000)
                        .ease("elastic")
			            .text(function(d) {
        			   		return d;
		        	   })
                       .attr("x", function(d, i) {
			   		        return xScale(i) + xScale.rangeBand() / 2;
        			   })
			           .attr("y", function(d) {
        			        return h - yScale(d) + 14;
		        	   })
                });
           </script>
    </body>
</html>
